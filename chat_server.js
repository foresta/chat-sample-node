//8888?|?[?g??N???C?A???g???±?d???? e
var ws = require('websocket.io');
var server = ws.listen(8888, function(){
    console.log('\033[96m Server running at 127.0.0.1:8888 \033[39m');
});

//?N???C?A???g?c?c???±?C?x???g???
server.on('connection', function(socket) {
    socket.on('message', function(data) {
	//?s????d??A
	var data = JSON.parse(data);
	var d = new Date();
	data.time = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate() + " " + d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds();
	data = JSON.stringify(data);
	console.log('\033[96m' + data + '\033[39m');

	//?o?M?μ?????b?Z?[?W?????N???C?A???g????M?・?e
	server.clients.forEach(function(client) {
	    client.send(data);
	});
    });
});
